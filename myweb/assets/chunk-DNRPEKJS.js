import{a as b}from"./chunk-TBXP7WCQ.js";import{n as m,o as E}from"./chunk-NQE72YS2.js";import{$ as p,E as n,Q as u,Y as l,da as c,o as i,p as d,s as a}from"./chunk-F7PPLVIA.js";var g={LIST_USERS:"/users/",GET_USER:o=>`/users/${o}`,UPDATE_USER:o=>`/users/${o}`,DELETE_USER:o=>`/users/${o}`,GET_ME:"/users/me"};var U=class o{constructor(e,r,t){this.apiService=e;this.logger=r;this.storage=t}TIMEOUT_MS=1e4;RETRY_COUNT=2;isLoggedIn(){return!!this.storage.getToken()}getAll(){return this.isLoggedIn()?this.apiService.get(g.LIST_USERS).pipe(a(this.TIMEOUT_MS),u(this.RETRY_COUNT),l(()=>this.logger.debug("Usuarios obtenidos exitosamente")),n(e=>(this.logger.error("Obtener todos los usuarios fall\xF3",e),i([])))):(this.logger.debug("Usuario no autenticado, retornando array vac\xEDo"),i([]))}getById(e){return this.isLoggedIn()?this.apiService.get(g.GET_USER(Number(e))).pipe(a(this.TIMEOUT_MS),u(this.RETRY_COUNT),l(()=>this.logger.debug(`Usuario ${e} obtenido exitosamente`)),n(r=>(this.logger.error(`Obtener usuario ${e} fall\xF3`,r),i(null)))):(this.logger.debug("Usuario no autenticado, retornando null"),i(null))}getMe(){return this.isLoggedIn()?this.apiService.get(g.GET_ME).pipe(a(this.TIMEOUT_MS),u(this.RETRY_COUNT),l(()=>this.logger.debug("Datos del usuario autenticado obtenidos exitosamente")),n(e=>(this.logger.error("Obtener datos del usuario autenticado fall\xF3",e),i(null)))):(this.logger.debug("Usuario no autenticado, retornando null"),i(null))}update(e,r){return this.apiService.put(g.UPDATE_USER(Number(e)),r).pipe(a(this.TIMEOUT_MS),u(this.RETRY_COUNT),l(()=>this.logger.debug(`Usuario ${e} actualizado exitosamente`)),n(t=>this.handleError(`Actualizar usuario ${e}`,t)))}delete(e){return this.apiService.delete(g.DELETE_USER(Number(e))).pipe(a(this.TIMEOUT_MS),u(this.RETRY_COUNT),l(()=>this.logger.debug(`Usuario ${e} eliminado exitosamente`)),n(r=>this.handleError(`Eliminar usuario ${e}`,r)))}handleError(e,r){this.logger.error(`${e} fall\xF3`,r);let t="Ocurri\xF3 un error inesperado";if(r instanceof Error)t=r.message;else if(typeof r=="object"&&r!==null&&"status"in r){let s=r;switch(s.status){case 400:t=s.error?.message||s.error?.detail||"Datos de solicitud inv\xE1lidos";break;case 401:t=s.error?.message||"Credenciales inv\xE1lidas o token expirado",this.storage.clearStorage();break;case 403:t=s.error?.message||"Acci\xF3n no permitida";break;case 404:t=s.error?.message||"Recurso no encontrado";break;default:t=s.error?.message||"Error del servidor"}}return d(()=>new Error(t))}static \u0275fac=function(r){return new(r||o)(c(E),c(m),c(b))};static \u0275prov=p({token:o,factory:o.\u0275fac,providedIn:"root"})};export{U as a};
